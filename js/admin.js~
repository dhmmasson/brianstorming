

function tryInitSocket (e) {

    var address = (e.currentTarget.value) ;
    address = (address.match(/\d{1,3}[.]\d{1,3}[.]\d{1,3}[.]\d{1,3}:\d{1,4}/)) ;
    if (address) {
	$("#GoButton").prop( "disabled", false );
        localStorage["address"]=address;
        localStorage["name"]= $("#name").val() || "Anonymous" + ~~(Math.random() *1000) ; 
	

    }
}


function boot() {


$("#name").val(localStorage["name"]|| "Anonymous" + ~~(Math.random() *1000))
$("#serveurAddress")
    .change(tryInitSocket)
    .keyup(tryInitSocket)
    .blur(tryInitSocket)
    .focus(tryInitSocket)
    .val(localStorage["address"]||"")

    if(window.location.search=="?admin") {
	console.log(location.search)
	$("#adminBox").css("display", "block") ;
	$("#GroupId").val(~~localStorage.groupId + 1) ; 
	$("#Title").val( localStorage.title) ; 
	
	function starExperiment() {
	    localStorage.groupId = ($("#GroupId").val()) || localStorage.groupId ; 
	    localStorage.title = $("#Title").val() ||  localStorage.title ; 
	    $.post('http://localhost:8088/api', {id:1, jsonrpc: '2.0', method: this  , params:[  localStorage.groupId, "," , "'"+localStorage.title+"'" , ");" ]})   
	}

	$("#exp0").click(starExperiment.bind("startControlGroup(")) ;
	$("#expA").click(starExperiment.bind('startExperimentA(')) ; 
	$("#expB").click(starExperiment.bind('startExperimentB(')) ; 
	$("#expC").click(starExperiment.bind('startExperimentC(')) ; 
    

    } else {
	console.log(location.search)

	$("#infoBox").css("display", "block")
	$("#GoButton").click(function(){  console.log("aaa" ) ;
					  console.log( window ) ;
					  window.location = window.location.origin + '/clients/html/simple.html' 
				       })
    }
}
$(document).ready(boot);
